'use client';

import React, { useCallback, useMemo } from 'react';
import * as SliderPrimitive from '@radix-ui/react-slider';
import { cn } from '@/lib/utils';

interface PotSizeSliderProps {
  value: [number, number];
  onChange: (value: [number, number]) => void;
  min?: number;
  max?: number;
  step?: number;
  label?: string;
}

const PRESETS = [
  { label: 'Small', range: [0, 50], color: 'from-green-400 to-green-600' },
  { label: 'Medium', range: [50, 200], color: 'from-yellow-400 to-yellow-600' },
  { label: 'Large', range: [200, 1000], color: 'from-orange-400 to-red-600' },
  { label: 'All', range: [0, 1000], color: 'from-gray-400 to-gray-600' },
];

export function PotSizeSlider({
  value,
  onChange,
  min = 0,
  max = 1000,
  step = 10,
  label = 'Pot Size (Big Blinds)',
}: PotSizeSliderProps) {
  const [minVal, maxVal] = value;

  const handleValueChange = useCallback(
    (newValue: number[]) => {
      if (newValue.length === 2) {
        onChange([newValue[0], newValue[1]]);
      }
    },
    [onChange],
  );

  const handlePresetClick = useCallback(
    (range: [number, number]) => {
      onChange(range);
    },
    [onChange],
  );

  const rangePercentage = useMemo(() => {
    const range = max - min;
    return {
      left: ((minVal - min) / range) * 100,
      right: ((maxVal - min) / range) * 100,
    };
  }, [minVal, maxVal, min, max]);

  const getGradientColor = useMemo(() => {
    const midpoint = (minVal + maxVal) / 2;
    const range = max - min;
    const position = (midpoint - min) / range;

    if (position < 0.25) return 'from-green-400 to-green-600';
    if (position < 0.5) return 'from-yellow-400 to-yellow-600';
    if (position < 0.75) return 'from-orange-400 to-orange-600';
    return 'from-red-400 to-red-600';
  }, [minVal, maxVal, min, max]);

  return (
    <div className="space-y-4">
      {/* Label */}
      <div className="flex items-center justify-between">
        <label className="block text-sm font-semibold text-gray-900" id="pot-slider-label">
          {label}
        </label>
        <div className="flex gap-2">
          <span
            className="px-3 py-1 bg-blue-50 text-blue-700 rounded-lg text-sm font-semibold"
            aria-label={`Minimum pot size: ${minVal} big blinds`}
          >
            {minVal} BB
          </span>
          <span className="text-gray-500">–</span>
          <span
            className="px-3 py-1 bg-blue-50 text-blue-700 rounded-lg text-sm font-semibold"
            aria-label={`Maximum pot size: ${maxVal} big blinds`}
          >
            {maxVal} BB
          </span>
        </div>
      </div>

      {/* Preset Buttons */}
      <div className="flex flex-wrap gap-2">
        {PRESETS.map((preset) => {
          const isActive =
            minVal === preset.range[0] && maxVal === preset.range[1];
          return (
            <button
              key={preset.label}
              onClick={() => handlePresetClick(preset.range as [number, number])}
              className={cn(
                'px-4 py-2 rounded-lg font-medium text-sm transition-all focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500',
                isActive
                  ? `bg-gradient-to-r ${preset.color} text-white shadow-md`
                  : 'bg-gray-100 text-gray-700 hover:bg-gray-200',
              )}
              aria-pressed={isActive}
              aria-label={`${preset.label} pot size (${preset.range[0]} - ${preset.range[1]} BB)`}
              title={`${preset.label}: ${preset.range[0]} - ${preset.range[1]} BB`}
            >
              {preset.label}
            </button>
          );
        })}
      </div>

      {/* Slider */}
      <div className="space-y-3">
        <SliderPrimitive.Root
          value={[minVal, maxVal]}
          onValueChange={handleValueChange}
          min={min}
          max={max}
          step={step}
          minStepsBetweenThumbs={1}
          className="relative flex items-center select-none touch-none w-full h-6"
          aria-labelledby="pot-slider-label"
          aria-label={`Pot size range from ${minVal} to ${maxVal} big blinds`}
        >
          {/* Track */}
          <SliderPrimitive.Track className="relative h-2 w-full rounded-full bg-gray-200 overflow-hidden">
            {/* Range Highlight */}
            <div
              className={cn(
                'h-full bg-gradient-to-r transition-all',
                getGradientColor,
              )}
              style={{
                left: `${rangePercentage.left}%`,
                right: `${100 - rangePercentage.right}%`,
              }}
            />
          </SliderPrimitive.Track>

          {/* Min Thumb */}
          <SliderPrimitive.Thumb
            className={cn(
              'block w-5 h-5 rounded-full bg-white border-2 border-blue-500 shadow-lg cursor-grab active:cursor-grabbing transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500',
            )}
            aria-label="Minimum pot size"
            title={`Min: ${minVal} BB`}
          />

          {/* Max Thumb */}
          <SliderPrimitive.Thumb
            className={cn(
              'block w-5 h-5 rounded-full bg-white border-2 border-blue-500 shadow-lg cursor-grab active:cursor-grabbing transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500',
            )}
            aria-label="Maximum pot size"
            title={`Max: ${maxVal} BB`}
          />
        </SliderPrimitive.Root>

        {/* Value Labels Below Slider */}
        <div className="flex justify-between text-xs text-gray-500 px-1">
          <span>{min}</span>
          <span>{Math.round((min + max) / 2)}</span>
          <span>{max}</span>
        </div>
      </div>

      {/* Summary */}
      <div className="p-3 bg-gray-50 rounded-lg border border-gray-200">
        <p className="text-sm text-gray-700">
          <span className="font-medium">Range:</span> {minVal} - {maxVal} BB
          {maxVal - minVal > 0 && (
            <span className="text-gray-500 ml-2">
              ({maxVal - minVal} BB span)
            </span>
          )}
        </p>
      </div>

      {/* Help Text */}
      <p className="text-xs text-gray-500">
        Drag the sliders to adjust pot size range • Use presets for quick filtering
      </p>
    </div>
  );
}
